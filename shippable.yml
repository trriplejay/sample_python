language: python
python:
  - 2.6
env:
  #- MODE=params
  - MODE=image
  
build:
  pre_ci:
    - ls -latr /build
  ci:
    - pip install -r requirements.txt
    - java -version
    - echo "hello world"
    - nosetests test.py --with-xunit --xunit-file=shippable/testresults/nosetests.xml
    - ls -altr /build
    - ls -latr /build/state
  push:
    - ls -latr /build
    - source /build/OUT/simple-image-runShSample/integration.env
    - docker login -u $username -p $password -e $email 2>&1 || echo "failed to login"
    - 'if [ $MODE == "image" ]; then echo "versionName=$BRANCH.$BUILD_NUMBER" >> $JOB_STATE/simple-image-runShSample.env; fi'
    - 'if [ $MODE == "params" ]; then echo "test=$BUILD_NUMBER" >> $JOB_STATE/myParams-runShSample.env; fi'
    - echo "versionName=$BRANCH.$BUILD_NUMBER" >> /build/state/sample_python_runCI.env
    #- docker push $USERNAME/imagename:$BRANCH.$BUILD_NUMBER
    
  on_failure:
    - echo 'boo'
    #- cd /fake/dir
    #- echo 'shouldnt get here'
  
  on_success:
    - echo 'it worked!'
    #- cd /fake/dir
    #- echo 'shouldnt get here'
